{% load crispy_forms_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Business Loan Form</title>

<!--sweet Alert-->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!--custom css-->

    <link rel="stylesheet" href="{% static "apply_for_business_loan.css" %}">
    <!-- Include Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
      integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I"
      crossorigin="anonymous"
    />
    <!-- <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script> -->

    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js"
      integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/"
      crossorigin="anonymous"
    ></script>

    
  </head>
  <body>

    <style>
      #id_pan_card_number{
        text-transform: uppercase;
      }
      textarea {

     resize: none;

   }
    </style>
    <div class="container mt-5">
      <h2 class="text-center">Business Loan Application Form</h2>

      
        
      <form method="post" id="form">
        {% csrf_token %}
        
        <div class="row">
            <div class="col-lg-4 col-6">{{ form.first_name|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.last_name|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.gender|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.date_of_birth|as_crispy_field }}</div>
            <div class="col-lg-4 col-6"> {{ form.mobile_number|as_crispy_field }} <div id="number-error1"></div></div>
            <div class="col-lg-4 col-6">{{ form.pan_card_number|as_crispy_field  }}<p id="pan-error"></p></div>
            <div class="col-lg-4 col-6">{{ form.aadhar_card_number|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.marital_status|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.email_id|as_crispy_field }}</div>
            
            <div class="col-lg-4 col-6">{{ form.current_adress_type|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.current_address|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.current_address_pincode|as_crispy_field }}</div>
            
            <div class="col-lg-4 col-6">{{ form.aadhar_adress_type|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.aadhar_address|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.aadhar_pincode|as_crispy_field }}</div>

            
            <div class="col-lg-4 col-6">{{ form.total_job_experience|as_crispy_field }}</div>

            <div class="col-lg-4 col-6">{{ form.running_emis_amount_per_month|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.net_income_per_month|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.business_name|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.business_type|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.business_establishment_date|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.has_gst_certificate|as_crispy_field }}</div>
            <div class="col-lg-4 col-6" id="gst_number_field">{{ form.gst_number|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.mother_name|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.father_name|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.nature_of_business|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.turnover_in_lakhs_per_year|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.business_address|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.business_address_pincode|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.required_loan_amount|as_crispy_field }}</div>
           
            <div class="col-lg-4 col-6">{{ form.ref1name|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.ref1mobilenumber|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.ref2name|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.ref2mobilenumber|as_crispy_field }}</div>
            
            <!-- <div class="col-lg-4 col-6">{{ form.dsaref_code|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.franrefCode|as_crispy_field }}</div> -->

            <div class="col-lg-4 col-6">{{ form.own_house|as_crispy_field }}</div>
            <div class="col-lg-4 col-6">{{ form.remarks|as_crispy_field }}</div>
        </div>
        <div class="mt-3 text-center">
            <button type="submit" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>




    <script>


if(localStorage.getItem('mobilenumber3')){
 document.getElementById('id_mobile_number').value=localStorage.getItem('mobilenumber3');
document.getElementById('id_mobile_number').readOnly=true;
document.getElementById('id_pan_card_number').value=localStorage.getItem('busiPanField');
document.getElementById('id_pan_card_number').readOnly=true;
}
const form2 = document.getElementById('form');
form2.addEventListener('submit', function () {
       
        localStorage.removeItem('mobilenumber3');
        localStorage.removeItem('busiPanField');

    });


      
// console.log(localStorage.getItem('mobilenumber'));
// console.log("tt")
// if(localStorage.getItem('mobilenumber1')){
//   console.log("iiiii////");
//   console.log(localStorage.getItem('mobilenumber1'));
//  document.getElementById('id_mobile_number').value= localStorage.getItem('mobilenumber1');
// document.getElementById('id_mobile_number').readOnly=true;
// console.log("lllllll////");
// const mobilenumber=localStorage.getItem('mobilenumber1');
// fetch(`http://127.0.0.1:8000/bl/getBasicdetailapplicationid/${mobilenumber}`)
//   .then(response => response.json()) 

//   .then(res => {
//     Swal.fire({
//   title: '<strong>YOUR APPLICATION ID IS:</strong>',
//   html: `<b>${res[0].application_id}</b>`,
//   icon: 'success'
// });
 
//   })

//   .catch(error => {
//     console.error("Error fetching data:", error);
//   });

// }

      console.log("Apply for ...");

      // Storing User details to Local Storage Browser for refresh overcome
    const form = document.getElementById('form');
    if (localStorage.getItem('formData')) {
        const formData = JSON.parse(localStorage.getItem('formData'));
        for (const key in formData) {
            if (formData.hasOwnProperty(key)) {
                const field = form.elements.namedItem(key);
               
                if (field && field.name!="mobile_number" && field.name!="pan_card_number") {
                    field.value = formData[key];
                }
            }
        }
    }

    form.addEventListener('input', function () {
        const formData = {};
        for (let i = 0; i < form.elements.length; i++) {
            const element = form.elements[i];
           
            if (element.name) {
                formData[element.name] = element.value;
            }
        }
        localStorage.setItem('formData', JSON.stringify(formData));
    });

    form.addEventListener('submit', function () {
        localStorage.removeItem('formData');
        localStorage.removeItem('mobilenumber1');

    });

    function sendUrlToParent() {
           
            window.parent.postMessage(window.location.href, '*'); // Replace '*' with the specific origin if needed
        }

        
       window.onload = sendUrlToParent;



    window.addEventListener('message', function(event) {
    
  
    if (event.data === 'Apply custom styles') {
        document.body.style.backgroundColor = 'white';

       

        var style = document.createElement('style');
        style.innerHTML = `
           body::-webkit-scrollbar{
           display:none;
           }
        `;
        document.head.appendChild(style);
    

    }
});

//   var element=document.createElement('p');
//     element.classList.add('invalid-feedback');
//     element.textContent="Invalid Referal Code";
//     document.getElementById('div_id_dsaref_code').appendChild(element)

// var refValid=true;


// // Referal VAlidation
// async function referalVAlidation(){

//  var referalCode=document.getElementById('id_dsaref_code').value;
 

//   if (referalCode!='') {

//  var respose=await fetch(`http://127.0.0.1:8001/dsa/getDsa/${referalCode}`)
//  if (respose.status===200){
//   document.getElementById('id_dsaref_code').classList.remove('is-invalid');
//   var res=await respose.json();
//  console.log(res);
//   refValid=true;
//   }

//   else{
//   //  console.log("else part")
//    document.getElementById('id_dsaref_code').classList.add('is-invalid');
//    refValid=false;
//   //  console.log(refValid+"jjjjjjjjjjkkkkkkkkk");

//   }
//  }
 
 
//  }
 
//  referalVAlidation();
// document.querySelector('#id_dsaref_code').addEventListener('change',referalVAlidation);

// document.getElementById('form').addEventListener('submit', (e) => {
//                 if (!refValid) {
//                     e.preventDefault(); 
                   
//                 }
//             });



    </script>

    <br><br><br>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="{% static 'businessLoanJs/BusiMain.js' %}?v=3"></script>

    <!-- Include Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.4/js/bootstrap.bundle.min.js"></script>
 </body>
</html>
